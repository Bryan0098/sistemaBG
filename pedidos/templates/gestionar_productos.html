{% extends 'base.html' %}

{% block title %}Gestionar Productos - Portal{% endblock %}

{% block content %}
<h1>Gestionar Productos</h1>

<!-- Mensajes de éxito o error -->
{% if messages %}
    <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<!-- Formulario para Crear Producto -->
<h2>Crear Producto</h2>
<form method="POST">
    {% csrf_token %}
    <label for="nombre">Nombre</label>
    <input type="text" id="nombre" name="nombre" required><br>

    <label for="descripcion">Descripción</label>
    <textarea id="descripcion" name="descripcion" required></textarea><br>

    <label for="precio">Precio</label>
    <input type="number" id="precio" name="precio" step="0.01" required><br>

    <label for="stock">Stock</label>
    <input type="number" id="stock" name="stock" required><br>

    <label for="stock_minimo">Stock Mínimo</label>
    <input type="number" id="stock_minimo" name="stock_minimo" required><br>

    <label for="categoria">Categoría</label>
    <select id="categoria" name="categoria">
        {% for categoria in categorias %}
            <option value="{{ categoria.id_categoria }}">{{ categoria.nombre }}</option>
        {% endfor %}
    </select><br>

    <label for="proveedor">Proveedor</label>
    <select id="proveedor" name="proveedor">
        {% for proveedor in proveedores %}
            <option value="{{ proveedor.id_proveedor }}">{{ proveedor.nombre }}</option>
        {% endfor %}
    </select><br>

    <button type="submit" name="crear">Crear Producto</button>
</form>

<hr>

<!-- Lista de Productos -->
<h2>Lista de Productos</h2>
<ul>
    {% for producto in productos %}
        <li>
            {{ producto.nombre }} - {{ producto.descripcion }} - {{ producto.precio }} - {{ producto.stock }}
            
            <!-- Formulario para Actualizar Producto -->
            <button onclick="document.getElementById('update-form-{{ producto.id_producto }}').style.display = 'block'">Editar</button>
            <form id="update-form-{{ producto.id_producto }}" method="POST" style="display:none;">
                {% csrf_token %}
                <input type="hidden" name="id_producto" value="{{ producto.id_producto }}">
                <input type="text" name="nombre" value="{{ producto.nombre }}" required><br>
                <textarea name="descripcion" required>{{ producto.descripcion }}</textarea><br>
                <input type="number" name="precio" value="{{ producto.precio }}" step="0.01" required><br>
                <input type="number" name="stock" value="{{ producto.stock }}" required><br>
                <input type="number" name="stock_minimo" value="{{ producto.stock_minimo }}" required><br>
                <button type="submit" name="actualizar">Actualizar Producto</button>
            </form>

            <!-- Formulario para Eliminar Producto -->
            <form method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="id_producto" value="{{ producto.id_producto }}">
                <button type="submit" name="eliminar" onclick="return confirm('¿Estás seguro de eliminar este producto?')">Eliminar</button>
            </form>
        </li>
    {% endfor %}
</ul>

{% endblock %}
