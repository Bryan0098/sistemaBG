{% extends 'base.html' %}

{% block title %}Gestionar Pedidos - Portal{% endblock %}

{% block content %}
<h1>Gestionar Pedidos</h1>

<!-- Mensajes de éxito o error -->
{% if messages %}
    <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<!-- Formulario para Crear Pedido -->
<h2>Crear Pedido</h2>
<form method="POST">
    {% csrf_token %}
    <label for="cliente">Cliente</label>
    <select id="cliente" name="id_cliente">
        {% for cliente in clientes %}
            <option value="{{ cliente.id_cliente }}">{{ cliente.nombre }} {{ cliente.apellido }}</option>
        {% endfor %}
    </select><br>

    <label for="estado">Estado</label>
    <input type="text" id="estado" name="estado" required><br>

    <label for="total">Total</label>
    <input type="number" id="total" name="total" step="0.01" required><br>

    <button type="submit" name="crear">Crear Pedido</button>
</form>

<hr>

<!-- Lista de Pedidos -->
<h2>Lista de Pedidos</h2>
<ul>
    {% for pedido in pedidos %}
        <li>
            Pedido ID: {{ pedido.id_pedido }} - Cliente: {{ pedido.cliente.nombre }} {{ pedido.cliente.apellido }} - Estado: {{ pedido.estado }} - Total: {{ pedido.total }}
            
            <!-- Formulario para Actualizar Pedido -->
            <button onclick="document.getElementById('update-form-{{ pedido.id_pedido }}').style.display = 'block'">Editar</button>
            <form id="update-form-{{ pedido.id_pedido }}" method="POST" style="display:none;">
                {% csrf_token %}
                <input type="hidden" name="id_pedido" value="{{ pedido.id_pedido }}">
                <select name="id_cliente">
                    {% for cliente in clientes %}
                        <option value="{{ cliente.id_cliente }}" {% if cliente.id_cliente == pedido.cliente.id_cliente %}selected{% endif %}>{{ cliente.nombre }} {{ cliente.apellido }}</option>
                    {% endfor %}
                </select><br>
                <input type="text" name="estado" value="{{ pedido.estado }}" required><br>
                <input type="number" name="total" value="{{ pedido.total }}" step="0.01" required><br>
                <button type="submit" name="actualizar">Actualizar Pedido</button>
            </form>

            <!-- Formulario para Eliminar Pedido -->
            <form method="POST" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="id_pedido" value="{{ pedido.id_pedido }}">
                <button type="submit" name="eliminar" onclick="return confirm('¿Estás seguro de eliminar este pedido?')">Eliminar</button>
            </form>
        </li>
    {% endfor %}
</ul>
{% endblock %}
